{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport React, { useEffect, useRef } from 'react';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { hasReactNode, isFunction, setRef } from '../../lib/utils';\nimport { classNames } from '../../lib/classNames';\nimport { getClassName } from '../../helpers/getClassName';\nexport var WriteBar = function WriteBar(props) {\n  var platform = usePlatform();\n\n  var className = props.className,\n      style = props.style,\n      before = props.before,\n      inlineAfter = props.inlineAfter,\n      after = props.after,\n      value = props.value,\n      onChange = props.onChange,\n      getRootRef = props.getRootRef,\n      getRef = props.getRef,\n      onHeightChange = props.onHeightChange,\n      restProps = _objectWithoutProperties(props, [\"className\", \"style\", \"before\", \"inlineAfter\", \"after\", \"value\", \"onChange\", \"getRootRef\", \"getRef\", \"onHeightChange\"]);\n\n  var isControlledOutside = value != null;\n  var textareaRef = useRef(null);\n  var textareaMinHeightRef = useRef(null);\n\n  var resize = function resize() {\n    var textareaEl = textareaRef.current;\n\n    if (!textareaEl) {\n      return;\n    }\n\n    var offsetHeight = textareaEl.offsetHeight,\n        scrollHeight = textareaEl.scrollHeight;\n    var style = window.getComputedStyle(textareaEl);\n    var paddingTop = parseInt(style.paddingTop);\n    var paddingBottom = parseInt(style.paddingBottom);\n\n    if (textareaMinHeightRef.current === null) {\n      textareaMinHeightRef.current = offsetHeight;\n    }\n\n    var diff = paddingTop + paddingBottom + 10;\n\n    if (scrollHeight + diff <= offsetHeight) {\n      diff = 0;\n    }\n\n    textareaEl.style.height = '0px';\n    var height = textareaEl.scrollHeight - diff / 4;\n    textareaEl.style.height = String(Math.max(height, textareaMinHeightRef.current)) + 'px';\n\n    if (isFunction(onHeightChange)) {\n      onHeightChange();\n    }\n  };\n\n  var onTextareaChange = function onTextareaChange(event) {\n    if (isFunction(onChange)) {\n      onChange(event);\n    }\n\n    if (!isControlledOutside) {\n      resize();\n    }\n  };\n\n  var getTextareaElRef = function getTextareaElRef(element) {\n    textareaRef.current = element;\n    setRef(element, getRef);\n  };\n\n  useEffect(function () {\n    resize();\n  }, [value]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: getRootRef,\n    className: classNames(getClassName('WriteBar', platform), className),\n    style: style\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    className: \"WriteBar__form\",\n    onSubmit: function onSubmit(e) {\n      return e.preventDefault();\n    }\n  }, hasReactNode(before) && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"WriteBar__before\"\n  }, before), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"WriteBar__formIn\"\n  }, /*#__PURE__*/React.createElement(\"textarea\", _extends({}, restProps, {\n    className: \"WriteBar__textarea\",\n    onChange: onTextareaChange,\n    ref: getTextareaElRef,\n    value: value\n  })), hasReactNode(inlineAfter) && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"WriteBar__inlineAfter\"\n  }, inlineAfter)), hasReactNode(after) && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"WriteBar__after\"\n  }, after)));\n};","map":{"version":3,"sources":["../../../../src/components/WriteBar/WriteBar.tsx"],"names":["WriteBar","platform","usePlatform","className","style","before","inlineAfter","after","value","onChange","getRootRef","getRef","onHeightChange","restProps","props","isControlledOutside","textareaRef","useRef","textareaMinHeightRef","resize","textareaEl","offsetHeight","scrollHeight","window","paddingTop","parseInt","paddingBottom","diff","height","String","Math","isFunction","onTextareaChange","getTextareaElRef","setRef","useEffect","classNames","getClassName","e","hasReactNode"],"mappings":"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","sourcesContent":["import React, {\n  ChangeEventHandler,\n  FC,\n  ReactNode,\n  useEffect,\n  useRef,\n  TextareaHTMLAttributes,\n} from 'react';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { hasReactNode, isFunction, setRef } from '../../lib/utils';\nimport { classNames } from '../../lib/classNames';\nimport { getClassName } from '../../helpers/getClassName';\nimport { HasRef, HasRootRef } from '../../types';\n\nexport interface WriteBarProps extends TextareaHTMLAttributes<HTMLTextAreaElement>, HasRootRef<HTMLDivElement>, HasRef<HTMLTextAreaElement> {\n  /**\n   * Содержимое, отображаемое слево от поля ввода.\n   */\n  before?: ReactNode;\n  /**\n   * Содержимое, отображаемое поверх поля ввода (актуально для iOS)\n   */\n  inlineAfter?: ReactNode;\n  /**\n   * Содержимое, отображаемое справа от поля ввода\n   */\n  after?: ReactNode;\n  /**\n   * Вызывается при смене высоты поля ввода\n   */\n  onHeightChange?: VoidFunction;\n\n  children?: never;\n}\n\nexport const WriteBar: FC<WriteBarProps> = (props) => {\n  const platform = usePlatform();\n  const {\n    className,\n    style,\n\n    before,\n    inlineAfter,\n    after,\n\n    value,\n    onChange,\n\n    getRootRef,\n    getRef,\n    onHeightChange,\n    ...restProps\n  } = props;\n\n  const isControlledOutside = value != null;\n\n  const textareaRef = useRef<HTMLTextAreaElement | null>(null);\n  const textareaMinHeightRef = useRef<number | null>(null);\n\n  const resize = () => {\n    const textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n\n    const { offsetHeight, scrollHeight } = textareaEl;\n    const style = window.getComputedStyle(textareaEl);\n    const paddingTop = parseInt(style.paddingTop);\n    const paddingBottom = parseInt(style.paddingBottom);\n\n    if (textareaMinHeightRef.current === null) {\n      textareaMinHeightRef.current = offsetHeight;\n    }\n\n    let diff = paddingTop + paddingBottom + 10;\n\n    if (scrollHeight + diff <= offsetHeight) {\n      diff = 0;\n    }\n\n    textareaEl.style.height = '0px';\n\n    const height = textareaEl.scrollHeight - diff / 4;\n    textareaEl.style.height = String(Math.max(height, textareaMinHeightRef.current)) + 'px';\n\n    if (isFunction(onHeightChange)) {\n      onHeightChange();\n    }\n  };\n\n  const onTextareaChange: ChangeEventHandler<HTMLTextAreaElement> = (event) => {\n    if (isFunction(onChange)) {\n      onChange(event);\n    }\n\n    if (!isControlledOutside) {\n      resize();\n    }\n  };\n\n  const getTextareaElRef = (element: HTMLTextAreaElement) => {\n    textareaRef.current = element;\n    setRef(element, getRef);\n  };\n\n  useEffect(() => {\n    resize();\n  }, [value]);\n\n  return (\n    <div\n      ref={getRootRef}\n      className={classNames(getClassName('WriteBar', platform), className)}\n      style={style}\n    >\n      <form className=\"WriteBar__form\" onSubmit={(e) => e.preventDefault()}>\n        {hasReactNode(before) &&\n        <div className=\"WriteBar__before\">\n          {before}\n        </div>\n        }\n\n        <div className=\"WriteBar__formIn\">\n          <textarea\n            {...restProps}\n            className=\"WriteBar__textarea\"\n            onChange={onTextareaChange}\n            ref={getTextareaElRef}\n            value={value}\n          />\n\n          {hasReactNode(inlineAfter) &&\n          <div className=\"WriteBar__inlineAfter\">\n            {inlineAfter}\n          </div>\n          }\n        </div>\n\n        {hasReactNode(after) &&\n        <div className=\"WriteBar__after\">\n          {after}\n        </div>\n        }\n      </form>\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}